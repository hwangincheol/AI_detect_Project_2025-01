<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>ì‚¬ì§„ íƒì§€</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <style>
    .btn.active {
      background-color: #0d6efd !important;
      color: white !important;
      border-color: #0d6efd !important;
    }
    body {
        background-color: #121212;
        color: white;
        margin-bottom: 50px;
    }
    .container {
        max-width: 1400px;
        max-height: 90vh;
        margin-top: 50px;
    }
    #uploadedImage {
        margin-top: 20px;
        width: 100%;
        border-radius: 10px;
        border: 2px solid #007bff;
    }
    #capturedImage {
        margin-top: 20px;
        width: 100%;
        border-radius: 10px;
        border: 2px solid #007bff;
    }
    .col-left, .col-right {
        display: flex;
        flex-direction: column;
        justify-content: center;
    }
    .col-left {
        padding-right: 20px;
    }
    .col-right {
        padding-left: 20px;
    }
    button {
        width: 100%;
        margin-top: 20px;
    }
    #capturedDiv {
        display: none;
    }
    #detectedDiv {
        display: none;
    }
  </style>
</head>
<body>

<nav class="navbar navbar-dark bg-primary">
  <div class="container-fluid">
    <a class="navbar-brand mx-auto fs-3 fw-bold" href="#">ğŸŒŠ ë¶€ìœ ë¬¼ íƒì§€ ì›¹ì‚¬ì´íŠ¸</a>
  </div>
</nav>

<div class="container mt-3">
  <div class="d-flex justify-content-center gap-3">
    <a href="/photo" class="btn btn-outline-light btn-lg fw-bold" id="photoBtn">
      ğŸ“· ì‚¬ì§„ íƒì§€
    </a>
    <a href="/video" class="btn btn-outline-light btn-lg fw-bold" id="videoBtn">
      ğŸ¬ ë™ì˜ìƒ íƒì§€
    </a>
  </div>
</div>

<div class="container">
  <div class="row">
    <div class="col-md-6 col-left">
      <h2 class="mb-4 fw-bold text-white">ğŸ“¸ ì‚¬ì§„ ì—…ë¡œë“œ</h2>
      <div class="mt-4">
        <label for="imageUpload" class="form-label fw-bold text-white">ğŸ–¼ï¸ ì‚¬ì§„ íŒŒì¼ ì„ íƒ</label>
        <input type="file" class="form-control" id="imageUpload" accept="image/png, image/jpeg">
      </div>
    </div>
    <div class="col-md-6 col-right">
      <h2 class="mb-4 fw-bold text-white">ğŸ” íƒì§€ ê²°ê³¼</h2>
      <div class="mt-4">
        <h4 style="margin-top: 32px;" class="mt-4 fw-bold text-white">íƒì§€ëœ ì´ë¯¸ì§€ :</h4>
      </div>
    </div>
  </div>

  <div class="row">
    <div class="col-md-6 col-left">
      <div>
        <div id="imageBox"></div>
        <div class="button-container mt-3"> <!-- ë²„íŠ¼ë“¤ì„ ê°ì‹¸ëŠ” div -->
          <button class="btn btn-primary fw-bold text-white" id="captureButton">ìº¡ì²˜ íƒì§€</button>
        </div>
      </div>
    </div>
    <div class="col-md-6 col-right">
      <div id="capturedDiv">
        <img id="capturedImage" src="" alt="ìº¡ì²˜ëœ ì´ë¯¸ì§€" />
        <button class="btn btn-secondary fw-bold text-white" id="downloadButton" style="margin-top: 42px;">ë‹¤ìš´ë¡œë“œ</button>
      </div>
    </div>
  </div>

</div>

<script>
  const currentPath = window.location.pathname;

  if (currentPath === "/photo") {
      document.getElementById("photoBtn").classList.add("active");
  } else if (currentPath === "/video") {
      document.getElementById("videoBtn").classList.add("active");
  }

  // ì´ë¯¸ì§€ ì—…ë¡œë“œ ì²˜ë¦¬
  $("#imageUpload").on("change", function (event) {
    $("#imageBox").html("");    // ì—…ë¡œë“œëœ ì´ë¯¸ì§€ ì‚­ì œ
    $("#capturedImage").attr("src", "");  // ìº¡ì²˜ëœ ì´ë¯¸ì§€ ì´ˆê¸°í™”
    $("#capturedDiv").hide();  // ìº¡ì²˜ëœ ì´ë¯¸ì§€ ì˜ì—­ ìˆ¨ê¸°ê¸°

    const file = event.target.files[0];
    if (!file) return;

    // íŒŒì¼ íƒ€ì… í™•ì¸ (PNG, JPEGë§Œ í—ˆìš©)
    const allowedTypes = ["image/png", "image/jpeg"];
    if (!allowedTypes.includes(file.type)) {
      alert("âŒ PNG ë˜ëŠ” JPEG íŒŒì¼ë§Œ ì—…ë¡œë“œ ê°€ëŠ¥í•©ë‹ˆë‹¤.");
      return;
    }

    const reader = new FileReader();
    reader.onload = function(e) {
      // ì´ë¯¸ì§€ íŒŒì¼ì´ ì •ìƒì ìœ¼ë¡œ ë¡œë“œë˜ì—ˆì„ ë•Œ í‘œì‹œ
      $("#imageBox").html('<img id="uploadedImage" src="' + e.target.result + '" />');
    };
    reader.readAsDataURL(file);
  });

  // ìº¡ì²˜ ë²„íŠ¼ í´ë¦­ ì‹œ ì„œë²„ë¡œ ì „ì†¡
  $("#captureButton").on("click", function () {
    const imageFile = $("#imageUpload")[0].files[0];
    if (!imageFile) {
      alert("âŒ ë¨¼ì € ì´ë¯¸ì§€ë¥¼ ì—…ë¡œë“œí•´ì£¼ì„¸ìš”.");
      return;
    }

    const formData = new FormData();
    formData.append("file", imageFile);
    formData.append("message", "image capture");  // message ê°’ì„ ëª…ì‹œì ìœ¼ë¡œ ì¶”ê°€

    // ì„œë²„ë¡œ ì´ë¯¸ì§€ ì „ì†¡ (REST API)
    fetch('http://localhost:80/java_service', {
      method: 'POST',
      body: formData
    })
    .then(response => response.json())
    .then(data => {
      console.log('ì„œë²„ ì‘ë‹µ:', data);
      if (data && data.image) {
        // ì„œë²„ì—ì„œ ë°›ì€ ì´ë¯¸ì§€ë¥¼ í™”ë©´ì— í‘œì‹œ
        $("#capturedImage").attr("src", "data:image/png;base64," + data.image);
        $("#capturedDiv").show();
      } else {
        alert("ì´ë¯¸ì§€ ì²˜ë¦¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.");
      }
    })
    .catch(error => {
      console.error('Error:', error);
      alert("ì„œë²„ì™€ì˜ ì—°ê²°ì— ë¬¸ì œê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
    });
  });

  // ë‹¤ìš´ë¡œë“œ ë²„íŠ¼ í´ë¦­ ì‹œ
  $("#downloadButton").on("click", function() {
    const dataURL = $("#capturedImage").attr("src");
    if (!dataURL) return;

    if (confirm("ì´ë¯¸ì§€ë¥¼ ë‹¤ìš´ë¡œë“œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) {
        const link = document.createElement("a");
        link.href = dataURL;
        link.download = "download_image.png";
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
    }
  });

</script>

</body>
</html>
